<!-- admin.html -->
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Admin Panel ‚Äì Safe Crypto Vault</title>
  <link rel="stylesheet" href="style.css" />
  <style>
    body {
      background: #000022;
      color: #fff;
      font-family: 'Segoe UI', sans-serif;
      padding: 20px;
    }

    h1 {
      color: #00ffff;
      text-align: center;
      margin-bottom: 30px;
    }

    .section {
      background: #111133;
      border-radius: 12px;
      padding: 20px;
      margin-bottom: 30px;
      box-shadow: 0 0 15px #0ff4;
    }

    .section h2 {
      color: #0ff;
      border-bottom: 1px solid #0ff4;
      padding-bottom: 8px;
      margin-bottom: 15px;
    }

    .user-entry, .withdraw-entry {
      margin-bottom: 15px;
      padding: 10px;
      background-color: #1a1a40;
      border-radius: 10px;
      border-left: 4px solid #00ffff;
    }

    .user-entry span, .withdraw-entry span {
      display: block;
      margin: 4px 0;
    }

    .no-data {
      color: #aaa;
      text-align: center;
    }

    .status {
      font-weight: bold;
      text-transform: capitalize;
    }

    .status.pending {
      color: yellow;
    }

    .status.successful {
      color: lime;
    }

    .status.rejected {
      color: red;
    }

    a.back-link {
      display: block;
      text-align: center;
      margin-top: 40px;
      color: #0ff;
      text-decoration: none;
    }
  </style>
</head>
<body>
  <h1>üîê Admin Panel</h1>

  <div class="section">
    <h2>üë• Referral Activity</h2>
    <div id="referralList" class="no-data">Loading referral data...</div>
  </div>

  <div class="section">
    <h2>üí∏ Withdrawal Requests</h2>
    <div id="withdrawalList" class="no-data">Loading withdrawal data...</div>
  </div>

  <a class="back-link" href="dashboard.html">‚Üê Back to Dashboard</a>

  <script>
    document.addEventListener("DOMContentLoaded", () => {
      const users = JSON.parse(localStorage.getItem("users") || "[]");
      const deposits = JSON.parse(localStorage.getItem("deposits") || "[]");
      const withdrawals = JSON.parse(localStorage.getItem("withdrawals") || "[]");

      const referralList = document.getElementById("referralList");
      const withdrawalList = document.getElementById("withdrawalList");

      const referrals = {};

      users.forEach(user => {
        if (user.ref) {
          if (!referrals[user.ref]) referrals[user.ref] = [];
          referrals[user.ref].push(user);
        }
      });

      if (Object.keys(referrals).length === 0) {
        referralList.textContent = "No referral data available.";
      } else {
        referralList.innerHTML = "";

        Object.entries(referrals).forEach(([refWallet, invitedUsers]) => {
          let totalCommission = 0;
          invitedUsers.forEach(inv => {
            const userDeposits = deposits.filter(d => d.username === inv.username);
            let totalWithInterest = 0;
            userDeposits.forEach(d => {
              const months = d.duration === "1" ? 1 : d.duration === "3" ? 3 : 5;
              const interestRate = getInterestRate(d.amount);
              const interest = (d.amount * interestRate * months) / 100;
              totalWithInterest += d.amount + interest;
            });
            totalCommission += totalWithInterest * 0.10;
          });

          const div = document.createElement("div");
          div.className = "user-entry";
          div.innerHTML = `
            <span><strong>Referrer Wallet:</strong> ${refWallet}</span>
            <span><strong>Invited Users:</strong> ${invitedUsers.map(u => u.username).join(', ')}</span>
            <span><strong>Total 10% Commission:</strong> ${totalCommission.toFixed(2)} USDT</span>
          `;
          referralList.appendChild(div);
        });
      }

      if (withdrawals.length === 0) {
        withdrawalList.textContent = "No withdrawal requests yet.";
      } else {
        withdrawalList.innerHTML = "";
        withdrawals.forEach(req => {
          const countdownText = getCountdownText(req.timestamp);
          const div = document.createElement("div");
          div.className = "withdraw-entry";
          div.innerHTML = `
            <span><strong>User:</strong> ${req.username}</span>
            <span><strong>Amount:</strong> ${req.amount} USDT</span>
            <span><strong>Status:</strong> <span class="status ${req.status}">${req.status}</span></span>
            <span><strong>Requested:</strong> ${new Date(req.timestamp).toLocaleString()}</span>
            <span><strong>Next eligible in:</strong> ${countdownText}</span>
          `;
          withdrawalList.appendChild(div);
        });
      }

      function getInterestRate(amount) {
        if (amount < 2000) return 3.5;
        if (amount <= 5000) return 5.5;
        return 7.5;
      }

      function getCountdownText(timestamp) {
        const now = Date.now();
        const nextTime = timestamp + 7 * 24 * 60 * 60 * 1000;
        const diff = nextTime - now;
        if (diff <= 0) return "‚úÖ Now";
        const days = Math.floor(diff / (1000 * 60 * 60 * 24));
        const hours = Math.floor((diff / (1000 * 60 * 60)) % 24);
        const mins = Math.floor((diff / (1000 * 60)) % 60);
        return `${days}d ${hours}h ${mins}m`;
      }
    });
  </script>
</body>
</html>
