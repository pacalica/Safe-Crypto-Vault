<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Admin ‚Äì Safe Crypto Vault</title>
  <link rel="stylesheet" href="css/styles.css" />
  <link rel="icon" href="icons/icon-192.png" />
</head>
<body class="main-body" style="background-image: url('images/robot-bg.jpg');">

  <div class="sidebar">
    <h2>üõ°Ô∏è Vault</h2>
    <ul>
      <li><a href="dashboard.html">Dashboard</a></li>
      <li><a href="open-deposit.html">Open deposit</a></li>
      <li><a href="withdraw.html">Withdraw</a></li>
      <li><a href="history.html">History</a></li>
      <li><a href="team.html">My team</a></li>
      <li><a href="settings.html">Settings</a></li>
      <li><a href="security.html">Security</a></li>
      <li><a href="admin.html" class="active">Admin</a></li>
      <li><a href="login.html" onclick="logout()">Exit</a></li>
    </ul>
  </div>

  <div class="main-content">
    <h1>Admin Panel</h1>

    <div class="card">
      <h3>All Deposits</h3>
      <div id="depositsList"></div>
    </div>

    <div class="card">
      <h3>Withdraw Requests</h3>
      <div id="withdrawList"></div>
    </div>

    <div class="card">
      <h3>Referral Stats</h3>
      <div id="refStats"></div>
    </div>
  </div>

  <script>
    // Only allow if wallet is admin
    const ADMIN_WALLET = "0x124377FCe14439248a4959ce528314aA3A897321"; // Your address

    const user = JSON.parse(localStorage.getItem("vault_user") || "{}");
    if (!user.wallet || user.wallet.toLowerCase() !== ADMIN_WALLET.toLowerCase()) {
      alert("Access denied. Admins only.");
      location.href = "dashboard.html";
    }

    const deposits = JSON.parse(localStorage.getItem("vault_deposits") || "[]");
    const withdrawals = JSON.parse(localStorage.getItem("vault_withdrawals") || "[]");

    const allUsers = new Map();
    deposits.forEach(d => {
      if (!allUsers.has(d.wallet)) {
        allUsers.set(d.wallet, { total: 0, count: 0 });
      }
      allUsers.get(d.wallet).total += parseFloat(d.amount);
      allUsers.get(d.wallet).count++;
    });

    document.getElementById("depositsList").innerHTML = deposits.length === 0
      ? "<p>No deposits found.</p>"
      : deposits.map(d => `
          <div class="entry">
            <strong>${d.wallet}</strong> ‚Äì ${d.amount} USDT (${d.plan} plan) <br>
            Date: ${new Date(d.timestamp).toLocaleString()}
          </div>
        `).join("");

    document.getElementById("withdrawList").innerHTML = withdrawals.length === 0
      ? "<p>No withdraw requests.</p>"
      : withdrawals.map(w => `
          <div class="entry">
            <strong>${w.wallet}</strong> ‚Äì ${w.amount} USDT <br>
            Status: <b>${w.status}</b> <br>
            Date: ${new Date(w.timestamp).toLocaleString()}
          </div>
        `).join("");

    document.getElementById("refStats").innerHTML = [...allUsers.entries()].map(([wallet, info]) => `
      <div class="entry">
        ${wallet} ‚Äì ${info.total.toFixed(2)} USDT in ${info.count} deposits
      </div>
    `).join("");

    function logout() {
      localStorage.clear();
    }
  </script>
</body>
</html>
