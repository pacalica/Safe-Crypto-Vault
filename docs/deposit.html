<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Open Deposit ‚Äì Safe Crypto Vault</title>
  <link rel="stylesheet" href="css/style.css" />
</head>
<body>
  <div class="sidebar">
    <h2>Safe Crypto Vault</h2>
    <ul>
      <li><a href="dashboard.html">üìä Dashboard</a></li>
      <li><a href="deposit.html" class="active">‚ûï Open Deposit</a></li>
      <li><a href="withdraw.html">üí∏ Withdraw</a></li>
      <li><a href="history.html">üßæ History</a></li>
      <li><a href="myteam.html">üë• My Team</a></li>
      <li><a href="admin.html">üõ†Ô∏è Admin</a></li>
      <li><a href="#" onclick="logout()">üö™ Logout</a></li>
    </ul>
  </div>

  <div class="main">
    <h1>Open New Deposit</h1>

    <div class="box">
      <p><strong>USDT Deposit Address (BEP20):</strong></p>
      <p class="mono">0x124377FCe14439248a4959ce528314aA3A897321</p>
      <canvas id="qrCanvas"></canvas>
    </div>

    <div class="box">
      <label>Amount (USDT):</label>
      <input type="number" id="amount" min="10" placeholder="Enter amount" />

      <label>Duration:</label>
      <select id="duration">
        <option value="1m">1 Month</option>
        <option value="3m">3 Months</option>
        <option value="5m">5 Months</option>
      </select>

      <button onclick="confirmDeposit()">I've Sent Deposit</button>
    </div>
  </div>

  <!-- QR Code lib -->
  <script src="https://cdn.jsdelivr.net/npm/qrious/dist/qrious.min.js"></script>

  <!-- EmailJS -->
  <script src="https://cdn.jsdelivr.net/npm/emailjs-com@3/dist/email.min.js"></script>
  <script>
    emailjs.init("7_PGCuxLtg1WCWvU0"); // Replace with your EmailJS user ID
  </script>

  <script>
    const user = JSON.parse(localStorage.getItem("loggedInUser"));
    if (!user) window.location.href = "login.html";

    // QR Code generate
    const qr = new QRious({
      element: document.getElementById("qrCanvas"),
      value: "0x124377FCe14439248a4959ce528314aA3A897321",
      size: 180
    });

    function confirmDeposit() {
      const amount = parseFloat(document.getElementById("amount").value);
      const duration = document.getElementById("duration").value;

      if (isNaN(amount) || amount < 10) {
        alert("Minimum deposit is 10 USDT.");
        return;
      }

      // Save deposit in localStorage
      const deposits = JSON.parse(localStorage.getItem("deposits") || "[]");
      deposits.push({
        wallet: user.wallet,
        username: user.username,
        amount,
        duration,
        date: new Date().toISOString(),
        confirmed: false
      });
      localStorage.setItem("deposits", JSON.stringify(deposits));

      // Send email via EmailJS
      emailjs.send("service_mnaa5dl", "template_2pbn9v4", {
        username: user.username,
        wallet: user.wallet,
        amount: amount.toString(),
        duration: duration
      }).then(() => {
        alert("Deposit submitted & email sent. Await admin confirmation.");
        window.location.href = "dashboard.html";
      }).catch((error) => {
        console.error("Email error:", error);
        alert("Deposit saved, but email failed.");
        window.location.href = "dashboard.html";
      });
    }

    function logout() {
      localStorage.removeItem("loggedInUser");
      window.location.href = "login.html";
    }
  </script>
</body>
</html>
